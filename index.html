<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tush AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: "Inter", serif;
        }
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 60vh;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #4a5568;
            border-radius: 1rem;
            margin-bottom: 1rem; /* Add some space between chat container and input */
        }
        .typing-animation::after {
            content: 'â–‹';
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }
                .model-select-container {
                    position: absolute;
                    top: 1rem;
                    left: 1rem;
                }

                @media (max-width: 640px) {
                    .model-select-container {
                        position: static;
                        margin-bottom: 1rem;
                    }
                }
             .model-select{
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
                background-position: right 0.5rem center;
                background-repeat: no-repeat;
                background-size: 1.5em 1.5em;
                padding-right: 2.5rem;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }        
            .chat-messages{
            flex-grow: 1;
            padding: 1rem;
            background-color: #1a202c;
            border-radius: 1rem;
        }
        .user-message {
            background-color: #4a5568;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            align-self: flex-end;
        }
        .assistant-message {
            background-color: #2d3748;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            align-self: flex-start;
        }
        .thought-message {
            background-color: #1a202c;
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            align-self: flex-start;
            font-style: italic;
            color: #a0aec0;
        }
        .assistant-message p, .thought-message p {
            margin-bottom: 0.5rem;
        }
        .assistant-message ul, .assistant-message ol, .thought-message ul, .thought-message ol {
            margin-left: 1.5rem;
            margin-bottom: 0.5rem;
        }
        .assistant-message pre, .thought-message pre {
            background-color: #1a202c;
            padding: 0.5rem;
            border-radius: 0.25rem;
            overflow-x: auto;
        }
        .thought-dropdown {
            cursor: pointer;
        }
        .thought-content {
            display: none;
        }
        .model-select option[value="deepseek-r1-distill-qwen-32b"] {
        outline: 2px solid red;
        background-color: rgba(255, 0, 0, 0.1);
    }
    .new-chat-container {
        position: absolute;
        top: 1rem;
        right: 1rem;
    }

    @media (max-width: 640px) {
        .new-chat-container {
            position: static;
            margin-bottom: 1rem;
            text-align: right;
        }
    }
    #newChatButton {
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    #newChatButton i {
        font-size: 0.875rem; /* Adjust as needed */
    }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <div class="model-select-container">
        <div class="relative inline-block text-left">
            <select id="modelSelect" class="bg-gray-700 text-white px-4 py-2 rounded-full focus:outline-none appearance-none pr-8">
                <option value="deepseek-r1-distill-qwen-32b" selected>TushAI T1.0 Reasoning</option>
                <option value="qwen-2.5-32b">TushAI T1.0</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                    <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                </svg>
            </div>
        </div>
    </div>

    <div class="new-chat-container" style="display: none;">
        <button id="newChatButton" class="bg-gray-700 text-white px-4 py-2 rounded-full hover:bg-gray-600 transition-colors flex items-center">
            <i class="fas fa-plus mr-2"></i>
            <span>New Chat</span>
        </button>
    </div>
    <h1 class="text-2xl md:text-4xl font-bold mb-8">What can I help with?</h1>
    <!-- Rest of the body content -->
</body>
        <div class="w-full max-w-2xl mb-8 flex flex-col">
            <div id="chatContainer" class="chat-container rounded-t-lg mb-4" style="display: none;">
                <div id="chatMessages" class="chat-messages"></div>
            </div>
            <div class="flex items-center bg-gray-700 rounded-full" style="border: 1px solid #4a5568;">
            <input type="text" id="userInput" placeholder="Ask anything" class="bg-gray-600 text-white flex-grow outline-none px-4 py-2 rounded-l-full h-10">
            <button id="submitButton" class="bg-blue-500 text-white px-4 rounded-r-full h-10 flex items-center justify-center">
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
    </div>
    <footer class="text-gray-500 text-sm">
        By messaging Tush AI, you agree to our Terms and have read our Privacy Policy.
    </footer>

<script>
    const apiKey = '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';
    const apiUrl = 'https://api.groq.com/openai/v1/chat/completions';

    const userInput = document.getElementById('userInput');
    const submitButton = document.getElementById('submitButton');
    const chatMessages = document.getElementById('chatMessages');
    const chatContainer = document.getElementById('chatContainer');
    const modelSelect = document.getElementById('modelSelect');
    const newChatButton = document.getElementById('newChatButton');

    let currentModel = 'deepseek-r1-distill-qwen-32b';

    // Set initial selected option
    modelSelect.value = currentModel;

    // Function to update option styles
    function updateOptionStyles() {
        Array.from(modelSelect.options).forEach(option => {
            if (option.value === currentModel) {
                option.style.outline = '2px solid red';
                option.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
            } else {
                option.style.outline = 'none';
                option.style.backgroundColor = 'transparent';
            }
        });
    }

    // Call the function initially
    updateOptionStyles();

    // Modify the existing change event listener
    modelSelect.addEventListener('change', (e) => {
        currentModel = e.target.value;
        console.log('Model changed to:', currentModel);
        updateOptionStyles();
    });

    newChatButton.addEventListener('click', () => {
        chatMessages.innerHTML = '';
        chatContainer.style.display = 'none';
        userInput.value = '';
        document.querySelector('.new-chat-container').style.display = 'none'; // Hide the button
    });

    function typeWriter(element, html) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = html;
        const nodes = Array.from(tempDiv.childNodes);
        let index = 0;

        function addNextNode() {
            if (index < nodes.length) {
                const node = nodes[index].cloneNode(true);
                element.appendChild(node);
                index++;
                setTimeout(addNextNode, 20); // Adjust the timeout for faster/slower typing
            } else {
                element.classList.remove('typing-animation');
            }
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        addNextNode();
    }

    function addMessage(content, isUser = false, isThought = false) {
        if (isThought && currentModel === 'deepseek-r1-distill-qwen-32b') {
            const thoughtElement = document.createElement('div');
            thoughtElement.classList.add('thought-message', 'thought-dropdown');
            thoughtElement.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mr-2"></i>
                    <span>AI's Thought Process</span>
                </div>
                <div class="thought-content mt-2"></div>
            `;
            thoughtElement.querySelector('.flex').addEventListener('click', () => {
                const thoughtContent = thoughtElement.querySelector('.thought-content');
                const chevron = thoughtElement.querySelector('.fas');
                if (thoughtContent.style.display === 'none' || thoughtContent.style.display === '') {
                    thoughtContent.style.display = 'block';
                    chevron.classList.replace('fa-chevron-right', 'fa-chevron-down');
                } else {
                    thoughtContent.style.display = 'none';
                    chevron.classList.replace('fa-chevron-down', 'fa-chevron-right');
                }
            });
            chatMessages.appendChild(thoughtElement);
            const parsedContent = marked.parse(content);
            typeWriter(thoughtElement.querySelector('.thought-content'), parsedContent);
        } else if (!isThought) {
            const messageElement = document.createElement('div');
            messageElement.classList.add(isUser ? 'user-message' : 'assistant-message');
            if (isUser) {
                messageElement.textContent = content;
                chatMessages.appendChild(messageElement);
            } else {
                messageElement.classList.add('typing-animation');
                chatMessages.appendChild(messageElement);
                const parsedContent = marked.parse(content);
                typeWriter(messageElement, parsedContent);
            }
        }
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function parseResponse(content) {
        if (currentModel === 'deepseek-r1-distill-qwen-32b') {
            const thinkRegex = /<think>([\s\S]*?)<\/think>/;
            const thinkMatch = content.match(thinkRegex);

            if (thinkMatch) {
                const thought = thinkMatch[1].trim();
                const answer = content.replace(thinkRegex, '').trim();
                return { thought, answer };
            }
        }
        return { thought: '', answer: content };
    }

    submitButton.addEventListener('click', async () => {
        const userMessage = userInput.value.trim();
        if (!userMessage) return;

        if (chatContainer.style.display === 'none') {
            chatContainer.style.display = 'flex';
            chatContainer.classList.remove('rounded-t-lg', 'mb-4');
            showNewChatButton(); // Show the New Chat button after the first message
        }
        addMessage(userMessage, true);
        userInput.value = '';

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: currentModel,
                    messages: [
                        { role: 'system', content: currentModel === 'deepseek-r1-distill-qwen-32b' ? 
                            'You are a helpful assistant. Use Markdown formatting in your responses. Wrap your thinking process in <think> tags.' : 
                            'You are a helpful assistant. Use Markdown formatting in your responses.' },
                        { role: 'user', content: userMessage }
                    ]
                })
            });

            const data = await response.json();
            console.log('API Response:', data);

            if (!response.ok) {
                throw new Error(`API error: ${data.error?.message || 'Unknown error'}`);
            }

            if (data.choices && data.choices.length > 0 && data.choices[0].message) {
                const { thought, answer } = parseResponse(data.choices[0].message.content);
                if (thought) {
                    addMessage(thought, false, true);
                }
                addMessage(answer);
            } else {
                throw new Error('Unexpected response structure');
            }
        } catch (error) {
            console.error('Error:', error);
            addMessage(`Error: ${error.message}. Please try again.`);
        }
    });

    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            submitButton.click();
        }
    });
function showNewChatButton() {
    document.querySelector('.new-chat-container').style.display = 'block';
}
</script>
</html>
